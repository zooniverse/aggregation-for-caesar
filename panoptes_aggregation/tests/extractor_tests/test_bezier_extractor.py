from panoptes_aggregation import extractors
from .base_test_class import ExtractorTest

classification = {
    'annotations': [
        {
            'task': 'T0',
            'task_label': 'Draw Bezier some lines',
            'value': [
                {
                    'tool': 0,
                    'frame': 0,
                    'points': [
                        {'x': -0.3290185032381231, 'y': -0.32901850323812304},
                        {'x': 5.551115123125783e-17, 'y': -0.629018503238123},
                        {'x': 0.3290185032381231, 'y': -0.32901850323812304},
                        {'x': 0.629018503238123, 'y': 5.551115123125783e-17},
                        {'x': 0.3290185032381231, 'y': 0.32901850323812315},
                        {'x': -5.551115123125783e-17, 'y': 0.6290185032381231},
                        {'x': -0.3290185032381231, 'y': 0.32901850323812326},
                        {'x': -0.6290185032381232, 'y': 2.220446049250313e-16},
                        {'x': -0.3290185032381232, 'y': -0.32901850323812293}
                    ],
                    'details': [],
                    'tool_label': 'Tool name'
                },
                {
                    'tool': 0,
                    'frame': 0,
                    'points': [
                        {'x': 1.7491605521090414, 'y': 1.6547491189819135},
                        {'x': 2.0, 'y': 1.3547491189819134},
                        {'x': 2.2508394478909586, 'y': 1.6547491189819135},
                        {'x': 2.61367005503744, 'y': 1.8006065121300039},
                        {'x': 2.4058667524068293, 'y': 2.131874101903063},
                        {'x': 2.3792689518911567, 'y': 2.522018928379039},
                        {'x': 2.0, 'y': 2.426753558230047},
                        {'x': 1.6207310481088435, 'y': 2.522018928379039},
                        {'x': 1.5941332475931707, 'y': 2.131874101903063},
                        {'x': 1.38632994496256, 'y': 1.800606512130004}
                    ],
                    'details': [],
                    'tool_label': 'Tool name'
                },
                {
                    'tool': 0,
                    'frame': 0,
                    'points': [
                        {'x': -2.2041241452319316, 'y': 1.6464466094067263},
                        {'x': -2.0, 'y': 1.3464466094067262},
                        {'x': -1.7958758547680684, 'y': 1.6464466094067263},
                        {'x': -1.4340061610167711, 'y': 1.6732233047033631},
                        {'x': -1.5917517095361369, 'y': 2.0},
                        {'x': -1.434006161016771, 'y': 2.326776695296637},
                        {'x': -1.7958758547680682, 'y': 2.353553390593274},
                        {'x': -2.0, 'y': 2.6535533905932738},
                        {'x': -2.2041241452319316, 'y': 2.353553390593274},
                        {'x': -2.565993838983229, 'y': 2.3267766952966373},
                        {'x': -2.408248290463863, 'y': 2.0000000000000004},
                        {'x': -2.565993838983229, 'y': 1.6732233047033636}
                    ],
                    'details': [],
                    'tool_label': 'Tool name'
                }
            ]
        },
        {
            'task': 'T0',
            'task_label': 'Draw some lines',
            'value': []
        },
        {
            'task': 'T0',
            'task_label': 'Draw some lines',
            'value': [
                {
                    'tool': 0,
                    'frame': 0,
                    'points': [{'x': -2.2041241452319316, 'y': 1.6464466094067263}],
                    'details': [],
                    'tool_label': 'Tool name'
                }
            ]
        }
    ]
}

expected = {
    'frame0': {
        'T0_tool0_pathX': [
            [
                -0.3290185032381231,
                -0.2559032802963179,
                -0.1827880573545127,
                -0.10967283441270766,
                -0.03655761147090256,
                0.03655761147090261,
                0.10967283441270775,
                0.18278805735451287,
                0.2559032802963179,
                0.3290185032381231,
                0.3290185032381231,
                0.3882777624973824,
                0.4327222069418268,
                0.46235183657145645,
                0.47716665138627123,
                0.47716665138627123,
                0.46235183657145645,
                0.4327222069418268,
                0.38827776249738233,
                0.3290185032381231,
                0.3290185032381231,
                0.2559032802963179,
                0.1827880573545127,
                0.10967283441270766,
                0.03655761147090256,
                -0.03655761147090261,
                -0.10967283441270775,
                -0.18278805735451287,
                -0.2559032802963179,
                -0.3290185032381231,
                -0.3290185032381231,
                -0.38827776249738244,
                -0.43272220694182684,
                -0.46235183657145656,
                -0.47716665138627135,
                -0.47716665138627135,
                -0.4623518365714566,
                -0.43272220694182695,
                -0.38827776249738244,
                -0.3290185032381232
            ], [
                1.7491605521090414,
                1.8049026516403657,
                1.8606447511716895,
                1.916386850703014,
                1.972128950234338,
                2.027871049765662,
                2.0836131492969865,
                2.13935524882831,
                2.195097348359634,
                2.2508394478909586,
                2.2508394478909586,
                2.3244236086176198,
                2.3839180431769456,
                2.429322751568936,
                2.4606377337935905,
                2.4778629898509092,
                2.480998519740893,
                2.4700443234635405,
                2.4450004010188526,
                2.4058667524068293,
                2.4058667524068293,
                2.395602165238217,
                2.3766296484060123,
                2.348949201910216,
                2.312560825750827,
                2.267464519927846,
                2.213660284441273,
                2.1511481192911077,
                2.0799280244773497,
                2.0,
                2.0,
                1.9200719755226503,
                1.8488518807088925,
                1.7863397155587273,
                1.732535480072154,
                1.6874391742491728,
                1.6510507980897842,
                1.6233703515939872,
                1.6043978347617829,
                1.5941332475931707,
                1.5941332475931707,
                1.5549995989811471,
                1.529955676536459,
                1.519001480259107,
                1.5221370101490903,
                1.5393622662064095,
                1.570677248431064,
                1.6160819568230542,
                1.6755763913823798,
                1.7491605521090414
            ], [
                -2.2041241452319316,
                -2.15876322406928,
                -2.1134023029066284,
                -2.0680413817439773,
                -2.022680460581326,
                -1.9773195394186742,
                -1.931958618256023,
                -1.8865976970933713,
                -1.84123677593072,
                -1.7958758547680684,
                -1.7958758547680684,
                -1.7218753702587761,
                -1.660704891731475,
                -1.6123644191861661,
                -1.5768539526228487,
                -1.5541734920415229,
                -1.5443230374421892,
                -1.5473025888248466,
                -1.5631121461894957,
                -1.5917517095361369,
                -1.5917517095361369,
                -1.563112146189496,
                -1.5473025888248464,
                -1.5443230374421888,
                -1.5541734920415229,
                -1.5768539526228484,
                -1.6123644191861661,
                -1.660704891731475,
                -1.7218753702587757,
                -1.7958758547680682,
                -1.7958758547680682,
                -1.84123677593072,
                -1.886597697093371,
                -1.9319586182560227,
                -1.9773195394186742,
                -2.022680460581326,
                -2.0680413817439773,
                -2.1134023029066284,
                -2.15876322406928,
                -2.2041241452319316,
                -2.2041241452319316,
                -2.278124629741224,
                -2.3392951082685247,
                -2.387635580813834,
                -2.4231460473771516,
                -2.4458265079584773,
                -2.455676962557811,
                -2.4526974111751536,
                -2.436887853810504,
                -2.408248290463863,
                -2.408248290463863,
                -2.436887853810504,
                -2.452697411175153,
                -2.455676962557811,
                -2.4458265079584773,
                -2.423146047377151,
                -2.387635580813834,
                -2.3392951082685247,
                -2.2781246297412237,
                -2.2041241452319316
            ]
        ],
        'T0_tool0_pathY': [
            [
                -0.32901850323812304,
                -0.38827776249738233,
                -0.4327222069418267,
                -0.4623518365714564,
                -0.47716665138627123,
                -0.4771666513862711,
                -0.4623518365714564,
                -0.4327222069418267,
                -0.3882777624973822,
                -0.32901850323812304,
                -0.32901850323812304,
                -0.25590328029631787,
                -0.18278805735451267,
                -0.10967283441270761,
                -0.03655761147090253,
                0.03655761147090264,
                0.10967283441270778,
                0.1827880573545129,
                0.255903280296318,
                0.32901850323812315,
                0.32901850323812315,
                0.38827776249738244,
                0.43272220694182684,
                0.4623518365714565,
                0.47716665138627135,
                0.47716665138627135,
                0.4623518365714566,
                0.4327222069418269,
                0.3882777624973825,
                0.32901850323812326,
                0.32901850323812326,
                0.25590328029631815,
                0.18278805735451295,
                0.10967283441270789,
                0.03655761147090278,
                -0.036557611470902376,
                -0.10967283441270755,
                -0.18278805735451265,
                -0.25590328029631776,
                -0.32901850323812293
            ], [
                1.6547491189819135,
                1.5954898597226543,
                1.5510454152782096,
                1.5214157856485802,
                1.5066009708337653,
                1.5066009708337653,
                1.5214157856485804,
                1.5510454152782098,
                1.5954898597226541,
                1.6547491189819135,
                1.6547491189819135,
                1.6894508877879704,
                1.7287306861403224,
                1.7725885140389703,
                1.8210243714839134,
                1.8740382584751525,
                1.9316301750126872,
                1.9938001210965168,
                2.060548096726642,
                2.131874101903063,
                2.131874101903063,
                2.212580233754206,
                2.2813009286516466,
                2.3380361865953843,
                2.3827860075854184,
                2.41555039162175,
                2.436329338704379,
                2.445122848833304,
                2.4419309220085266,
                2.426753558230047,
                2.426753558230047,
                2.441930922008527,
                2.4451228488333037,
                2.436329338704378,
                2.41555039162175,
                2.382786007585418,
                2.3380361865953843,
                2.2813009286516466,
                2.212580233754206,
                2.131874101903063,
                2.131874101903063,
                2.060548096726642,
                1.9938001210965166,
                1.9316301750126872,
                1.8740382584751525,
                1.8210243714839136,
                1.7725885140389706,
                1.7287306861403227,
                1.6894508877879701,
                1.6547491189819135
            ], [
                1.6464466094067263,
                1.5871873501474671,
                1.5427429057030224,
                1.513113276073393,
                1.4982984612585781,
                1.4982984612585781,
                1.5131132760733932,
                1.5427429057030224,
                1.587187350147467,
                1.6464466094067263,
                1.6464466094067263,
                1.6561006898430162,
                1.673162177686713,
                1.6976310729378177,
                1.7295073755963295,
                1.7687910856622486,
                1.8154822031355757,
                1.8695807280163095,
                1.931086660304451,
                2.0,
                2.0,
                2.0689133396955492,
                2.1304192719836905,
                2.1845177968644247,
                2.2312089143377514,
                2.2704926244036705,
                2.302368927062183,
                2.326837822313287,
                2.343899310156984,
                2.353553390593274,
                2.353553390593274,
                2.4128126498525333,
                2.4572570942969776,
                2.4868867239266073,
                2.501701538741422,
                2.5017015387414223,
                2.4868867239266077,
                2.4572570942969776,
                2.4128126498525333,
                2.353553390593274,
                2.353553390593274,
                2.3438993101569845,
                2.326837822313287,
                2.302368927062183,
                2.270492624403671,
                2.2312089143377514,
                2.184517796864425,
                2.130419271983691,
                2.0689133396955492,
                2.0000000000000004,
                2.0000000000000004,
                1.9310866603044516,
                1.86958072801631,
                1.815482203135576,
                1.768791085662249,
                1.7295073755963297,
                1.697631072937818,
                1.6731621776867132,
                1.656100689843016,
                1.6464466094067263
            ]
        ]
    }
}


TestPolygon = ExtractorTest(
    extractors.bezier_extractor,
    classification,
    expected,
    'Test Bezier',
    test_name='TestBezier'
)

TestPolygonTask = ExtractorTest(
    extractors.bezier_extractor,
    classification,
    expected,
    'Test bezier with task specified',
    kwargs={
        'task': 'T0'
    },
    test_name='TestBezierTask'
)
